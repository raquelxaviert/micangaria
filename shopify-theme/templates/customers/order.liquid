{% comment %}
  Customer order template for miçangaria
{% endcomment %}

<div class="container py-12">
  <!-- Page Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="headline text-primary mb-2" style="font-size: 2rem;">Pedido #{{ order.name }}</h1>
      <p class="text-muted-foreground">
        Feito em {{ order.created_at | date: '%d de %B de %Y às %H:%M' }}
      </p>
    </div>
    
    <a href="/account" class="btn-outline">
      <i data-lucide="arrow-left" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></i>
      Voltar para conta
    </a>
  </div>

  <div class="grid grid-cols-1 lg-grid-cols-3" style="gap: 2rem;">
    <!-- Order Details -->
    <div class="lg-col-span-2">
      <!-- Order Status -->
      <div class="card mb-6">
        <h2 class="headline text-foreground mb-4" style="font-size: 1.25rem;">Status do Pedido</h2>
        
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center" style="gap: 0.75rem;">
            {% case order.fulfillment_status %}
              {% when 'fulfilled' %}
                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                <span class="text-green-700 font-medium">Entregue</span>
              {% when 'partial' %}
                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                <span class="text-yellow-700 font-medium">Parcialmente enviado</span>
              {% when 'shipped' %}
                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                <span class="text-blue-700 font-medium">Enviado</span>
              {% else %}
                <div class="w-3 h-3 bg-gray-500 rounded-full"></div>
                <span class="text-gray-700 font-medium">Processando</span>
            {% endcase %}
          </div>
          
          <div class="text-right">
            {% case order.financial_status %}
              {% when 'paid' %}
                <span class="badge" style="background: #10b981; color: white;">Pago</span>
              {% when 'pending' %}
                <span class="badge" style="background: #f59e0b; color: white;">Pendente</span>
              {% when 'refunded' %}
                <span class="badge" style="background: #ef4444; color: white;">Reembolsado</span>
              {% else %}
                <span class="badge badge-outline">{{ order.financial_status | capitalize }}</span>
            {% endcase %}
          </div>
        </div>

        <!-- Tracking Information -->
        {% if order.fulfillment_status != blank and order.fulfillment_status != 'unfulfilled' %}
          {% for fulfillment in order.fulfillments %}
            {% if fulfillment.tracking_number %}
              <div class="p-4 bg-muted rounded-lg" style="background: hsl(var(--muted));">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="font-medium text-foreground">Código de rastreamento</p>
                    <p class="text-muted-foreground text-sm">{{ fulfillment.tracking_company }}</p>
                  </div>
                  <div class="text-right">
                    <p class="font-mono text-sm text-foreground">{{ fulfillment.tracking_number }}</p>
                    {% if fulfillment.tracking_url %}
                      <a href="{{ fulfillment.tracking_url }}" target="_blank" class="text-primary text-sm hover-underline">
                        Rastrear pedido
                        <i data-lucide="external-link" style="width: 0.875rem; height: 0.875rem; margin-left: 0.25rem; display: inline-block; vertical-align: middle;"></i>
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>

      <!-- Order Items -->
      <div class="card">
        <h2 class="headline text-foreground mb-6" style="font-size: 1.25rem;">Itens do Pedido</h2>
        
        <div class="space-y-4">
          {% for line_item in order.line_items %}
            <div class="flex" style="gap: 1rem; padding-bottom: 1rem; border-bottom: 1px solid hsl(var(--border));">
              <!-- Product Image -->
              <div class="flex-shrink-0">
                {% if line_item.image %}
                  <img 
                    src="{{ line_item.image | img_url: '120x120' }}" 
                    alt="{{ line_item.title }}"
                    class="w-20 h-20 object-cover rounded-lg"
                  >
                {% else %}
                  <div class="w-20 h-20 bg-muted rounded-lg flex items-center justify-center" style="background: hsl(var(--muted));">
                    <i data-lucide="image" style="width: 2rem; height: 2rem; color: hsl(var(--muted-foreground));"></i>
                  </div>
                {% endif %}
              </div>

              <!-- Product Details -->
              <div class="flex-1">
                <h3 class="font-medium text-foreground mb-1">{{ line_item.title }}</h3>
                
                {% if line_item.variant.title != 'Default Title' %}
                  <p class="text-muted-foreground text-sm mb-2">{{ line_item.variant.title }}</p>
                {% endif %}

                {% if line_item.properties.size > 0 %}
                  <div class="text-sm text-muted-foreground mb-2">
                    {% for property in line_item.properties %}
                      <p>{{ property.first }}: {{ property.last }}</p>
                    {% endfor %}
                  </div>
                {% endif %}

                <div class="flex items-center justify-between">
                  <span class="text-muted-foreground text-sm">
                    Quantidade: {{ line_item.quantity }}
                  </span>
                  <div class="text-right">
                    {% if line_item.original_price != line_item.price %}
                      <span class="text-muted-foreground text-sm line-through">
                        {{ line_item.original_price | money }}
                      </span>
                    {% endif %}
                    <span class="font-medium text-foreground">
                      {{ line_item.price | money }} cada
                    </span>
                  </div>
                </div>
              </div>

              <!-- Line Total -->
              <div class="text-right">
                <span class="font-medium text-foreground">
                  {{ line_item.line_price | money }}
                </span>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Order Summary -->
    <div>
      <!-- Order Totals -->
      <div class="card mb-6">
        <h2 class="headline text-foreground mb-4" style="font-size: 1.25rem;">Resumo do Pedido</h2>
        
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-muted-foreground">Subtotal</span>
            <span class="text-foreground">{{ order.subtotal_price | money }}</span>
          </div>

          {% for discount in order.discounts %}
            <div class="flex justify-between">
              <span class="text-muted-foreground">Desconto ({{ discount.code }})</span>
              <span class="text-green-600">-{{ discount.amount | money }}</span>
            </div>
          {% endfor %}

          {% if order.shipping_price > 0 %}
            <div class="flex justify-between">
              <span class="text-muted-foreground">Frete</span>
              <span class="text-foreground">{{ order.shipping_price | money }}</span>
            </div>
          {% endif %}

          {% for tax_line in order.tax_lines %}
            <div class="flex justify-between">
              <span class="text-muted-foreground">{{ tax_line.title }}</span>
              <span class="text-foreground">{{ tax_line.price | money }}</span>
            </div>
          {% endfor %}

          <div class="border-t pt-3" style="border-color: hsl(var(--border));">
            <div class="flex justify-between">
              <span class="font-medium text-foreground">Total</span>
              <span class="font-medium text-foreground text-lg">{{ order.total_price | money }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Shipping Address -->
      {% if order.shipping_address %}
        <div class="card mb-6">
          <h3 class="headline text-foreground mb-4" style="font-size: 1.125rem;">Endereço de Entrega</h3>
          <div class="text-sm text-muted-foreground">
            <p>{{ order.shipping_address.name }}</p>
            <p>{{ order.shipping_address.address1 }}</p>
            {% if order.shipping_address.address2 != blank %}
              <p>{{ order.shipping_address.address2 }}</p>
            {% endif %}
            <p>{{ order.shipping_address.city }}, {{ order.shipping_address.province }} {{ order.shipping_address.zip }}</p>
            <p>{{ order.shipping_address.country }}</p>
            {% if order.shipping_address.phone != blank %}
              <p class="mt-2">Tel: {{ order.shipping_address.phone }}</p>
            {% endif %}
          </div>
        </div>
      {% endif %}

      <!-- Billing Address -->
      {% if order.billing_address %}
        <div class="card mb-6">
          <h3 class="headline text-foreground mb-4" style="font-size: 1.125rem;">Endereço de Cobrança</h3>
          <div class="text-sm text-muted-foreground">
            <p>{{ order.billing_address.name }}</p>
            <p>{{ order.billing_address.address1 }}</p>
            {% if order.billing_address.address2 != blank %}
              <p>{{ order.billing_address.address2 }}</p>
            {% endif %}
            <p>{{ order.billing_address.city }}, {{ order.billing_address.province }} {{ order.billing_address.zip }}</p>
            <p>{{ order.billing_address.country }}</p>
          </div>
        </div>
      {% endif %}

      <!-- Actions -->
      <div class="space-y-3">
        {% if order.customer_url %}
          <a href="{{ order.customer_url }}" class="btn-outline w-full text-center" style="display: block;">
            <i data-lucide="external-link" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></i>
            Ver no portal do cliente
          </a>
        {% endif %}

        {% if shop.email %}
          <a href="mailto:{{ shop.email }}?subject=Pedido {{ order.name }}" class="btn-outline w-full text-center" style="display: block;">
            <i data-lucide="mail" style="width: 1rem; height: 1rem; margin-right: 0.5rem;"></i>
            Entrar em contato
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
